<!-- root -->
<!-- participation dashboard for a course -->

{% extends "base.html" %}

{% block content %}
{% load submission_status %}
{% load submission_button %}
{% load static %}

<script src="{% static 'js/iframe-resizer/iframeResizer.min.js' %}"></script>

<script>
  function resizeIframe(obj) {
    obj.style.height = "0";
    obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
  }
</script>

<style>
  * {
    box-sizing: border-box;
  }

  /* Create two equal columns that floats next to each other */
  .column {
    float: left;
    width: 33%;
    padding: 1px 0.2px 1px 11.9px;
    /* border: 0.1px solid rgb(181, 176, 176); */
  }

  /* Clear floats after the columns */
  .row:after {
    content: "";
    display: table;
    clear: both;
  }

  /* Style for the popup */
  .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      z-index: 999;
    }

    input[type="date"] {
        appearance: none;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 6px;
        color: #333;
        background-color: #fff;
        font-size: 16px;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
        color: #999;
    }

</style>

<div class="container-fluid">

  <div class="row">
    <div class="col-xs-8 col-sm-8 col-md-8 col-xs-offset-2 col-md-offset-2 col-sm-offset-2">
        <div class="mta-header-with-btn">

          <div> <h2>{{ course.displayname }}</h2> </div>

          {% if is_instructor or is_ta or request.user.is_superuser %}
          <div class="btn-group">

            {% if is_instructor or request.user.is_superuser %}
            <form class="btn-group" method="post">
              {% csrf_token %}
      
              {% if lecture %}
              <button class="btn btn-danger " name="end-lecture">End Lecture</button>
              {% else %}
              <button class="btn btn-success " name="begin-lecture">Start Lecture</button>
              {% endif %}
            </form>
            {% endif %}

            <a class="btn btn-info " href="/course/{{ course.id }}/list_users/">
              <span class="glyphicon glyphicon-user"></span> Display Users
            </a>
  
            {% if not is_ta %}

            <a class="btn btn-primary " href="/course/{{ course.id }}/edit/">
              <span class="glyphicon glyphicon-pencil"></span> Edit Configurations
            </a>
            <div class="btn-group" style="padding: 0; margin: 0">
              <a class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="glyphicon glyphicon-save"></span> Export <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/course/{{ course.id }}/export_daily_participation_data/">Discussion Participation Today</a></li>
                <li onclick="openPopup('polls')"><a style="cursor: pointer;">Poll Participation per Day</a></li>
                <li onclick="openPopup('messages')"><a style="cursor: pointer;">Messages per Day</a></li>
                <!-- <li><a href="/course/{{ course.id }}/export_message_data/?date=true">Messages Per Day</a></li> -->
                <hr>
                <li><a href="/course/{{ course.id }}/export_participation_data/">All Discussion Participation</a></li>
                <li><a href="/course/{{ course.id }}/export_poll_participation_data/">All Poll Participation</a></li>
                <li><a href="/course/{{ course.id }}/export_message_data/">All Messages</a></li>
              </ul>
            </div>

            {% endif %}

          </div>
          {%else%}
          <div>
            In today's class, you have gained <span id='daily_points' style="color: blue">{{total_points_today}}</span> +
            <span id='daily_bonus' style="color: blue">{{total_points_bonus}}</span> bonus participations points so far.
          </div>
          {%endif%}

        </div>

        <div id="popup" class="popup">
          <input type="date" id="datePicker">
          <button class="btn btn-primary">OK</button>
          <button class="btn btn-danger" onclick="closePopup()">Cancel</button>
        </div>

        <script>
          function openPopup(type) {
            document.getElementById('popup').getElementsByTagName('button')[0].onclick = function() { getValue(type) };

            const popup = document.getElementById('popup');
            const today = new Date();
            const dd = String(today.getDate()).padStart(2, '0');
            const mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            const yyyy = today.getFullYear();

            const todayStr = yyyy + '-' + mm + '-' + dd;
            document.getElementById('datePicker').value = todayStr;

            popup.style.display = 'block';
          }

          function closePopup() {
            const popup = document.getElementById('popup');
            popup.style.display = 'none';
          }

          function getValue(type) {
            const selectedDate = document.getElementById('datePicker').value;
            
            if (type == 'polls') {
              window.location.href = `/course/{{ course.id }}/export_poll_participation_data/?date=${selectedDate}`;
            } else if (type == 'messages') {
              window.location.href = `/course/{{ course.id }}/export_message_data/?date=${selectedDate}`;
            }


            closePopup()
          }
        </script>

      
      <style>
        .btn-xl {
          padding: 10px 20px;
          font-size: 16px;
          border-radius: 10px;
          width: 300px;
        }
      </style>


      {% if is_student %}
      <div class="thumbnail" style="text-align: center;">
        <div class="row">
          <div class="col-md-7">
            <button class="btn btn-success btn-xl" id="hand_up">
              <span class="glyphicon glyphicon-hand-up"></span> Hand up in the Green list
            </button>
            <button class="btn btn-success btn-xl" id='hand_down'>
              <span class="glyphicon glyphicon-hand-down"></span> Hand down in the Green list
            </button>
          </div>
          <div class="col-md-5">
            <h4 id="student_green"></h4>
          </div>
        </div>

        <div class="row">
          <div class="col-md-7">
            <button class="btn btn-primary btn-xl" id="hand_up_blue">
              <span class="glyphicon glyphicon-hand-up"></span> Hand up in the Blue list
            </button>
            <button class="btn btn-primary btn-xl" id='hand_down_blue'>
              <span class="glyphicon glyphicon-hand-down"></span> Hand down in the Blue list
            </button>
          </div>
          <div class="col-md-5">
            <h4 id="student_blue"></h4>
          </div>
        </div>

        <div class="row">
          <div class="col-md-7">
            <button class="btn btn-danger btn-xl" id="hand_up_red">
              <span class="glyphicon glyphicon-hand-up"></span> Hand up in the Red list
            </button>
            <button class="btn btn-danger btn-xl" id='hand_down_red'>
              <span class="glyphicon glyphicon-hand-down"></span> Hand down in the Red list
            </button>
          </div>
          <div class="col-md-5">
            <h4 id="student_red"></h4>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-7">
            <button class="btn btn-warning btn-xl" id="hand_up_yellow">
              <span class="glyphicon glyphicon-hand-up"></span> Hand up in the Yellow list
            </button>
            <button class="btn btn-warning btn-xl" id='hand_down_yellow'>
              <span class="glyphicon glyphicon-hand-down"></span> Hand down in the Yellow list
            </button>
          </div>
          <div class="col-md-5">
            <h4 id="student_yellow"></h4>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-8">
          <iframe id="polling-student" scrolling="no" onload="resizeIframe(this)"  src="/polling/student" width="100%" frameborder="0"></iframe>
        </div>
        
        <div class="col-md-4">
          <h3>Message Board</h3>
          <iframe id="message-student" src="/message/student" width="100%" height="400px" frameborder="0"></iframe>
        </div>
      </div>

      <h4>Note: when your hand is up in any of the lists, it will go down automatically if you were chosen to speak in
        class or if all hands were cleared by the instructor.</h4>

      <script>
        iFrameResize({ heightCalculationMethod: 'documentElementOffset' }, '#polling-student')
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("hand_up")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/enable/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student_green").innerHTML = data['hand'];
            }
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("hand_up_blue")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/enable_blue/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student_blue").innerHTML = data['hand'];
            }
          });
        });
      </script>


      <script type="text/javascript">
        var btn = document.getElementById("hand_up_red")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/enable_red/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student_red").innerHTML = data['hand'];
            }
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("hand_up_yellow")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/enable_yellow/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student_yellow").innerHTML = data['hand'];
            }
          });
        });
      </script>

      <script type="text/javascript">
        var statusIntervalId = window.setInterval(update, 1000);
        function update() {
          $.ajax({
            url: '/check_status/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              if (data['disbale_green']) {
                document.getElementById("hand_up").disabled = true
                document.getElementById("hand_down").disabled = true
                document.getElementById("student_green").innerHTML = ''
              } else {
                document.getElementById("hand_up").disabled = false
                document.getElementById("hand_down").disabled = false
                document.getElementById("student_green").innerHTML = data['status_green'];
              }

              if (data['disbale_blue']) {
                document.getElementById("hand_up_blue").disabled = true
                document.getElementById("hand_down_blue").disabled = true
                document.getElementById("student_blue").innerHTML = ''
              } else {
                document.getElementById("hand_up_blue").disabled = false
                document.getElementById("hand_down_blue").disabled = false
                document.getElementById("student_blue").innerHTML = data['status_blue'];
              }

              if (data['disbale_red']) {
                document.getElementById("hand_up_red").disabled = true
                document.getElementById("hand_down_red").disabled = true
                document.getElementById("student_red").innerHTML = ''
              } else {
                document.getElementById("hand_up_red").disabled = false
                document.getElementById("hand_down_red").disabled = false
                document.getElementById("student_red").innerHTML = data['status_red'];
              }

              if (data['disbale_yellow']) {
                document.getElementById("hand_up_yellow").disabled = true
                document.getElementById("hand_down_yellow").disabled = true
                document.getElementById("student_yellow").innerHTML = ''
              } else {
                document.getElementById("hand_up_yellow").disabled = false
                document.getElementById("hand_down_yellow").disabled = false
                document.getElementById("student_yellow").innerHTML = data['status_yellow'];
              }


              // document.getElementById("student_blue").innerHTML = data['status_blue'];
              // document.getElementById("student_red").innerHTML = data['status_red'];
              // document.getElementById("student_yellow").innerHTML = data['status_yellow'];
              document.getElementById("daily_points").innerHTML = data['total_points_today'];
              document.getElementById("daily_bonus").innerHTML = data['total_bonus_points'];
              // document.getElementById("total_points").innerHTML = data['total_points'];
            }
          });
        }
      </script>




      <script type="text/javascript">
        var btn = document.getElementById("hand_down")
        btn.addEventListener("click", function () {
          document.getElementById("student_green").innerHTML = 'Your hand is down in the Green list.'
          $.ajax({
            url: '/disable/',
            method: 'GET',
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("hand_down_blue")
        btn.addEventListener("click", function () {
          document.getElementById("student_blue").innerHTML = 'Your hand is down in the Blue list.'
          $.ajax({
            url: '/disable_blue/',
            method: 'GET',
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("hand_down_red")
        btn.addEventListener("click", function () {
          document.getElementById("student_red").innerHTML = 'Your hand is down in the Red list.'
          $.ajax({
            url: '/disable_red/',
            method: 'GET',
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("hand_down_yellow")
        btn.addEventListener("click", function () {
          document.getElementById("student_yellow").innerHTML = 'Your hand is down in the Yellow list.'
          $.ajax({
            url: '/disable_yellow/',
            method: 'GET',
          });
        });
      </script>

      {%endif%}

      {% if is_instructor or request.user.is_superuser %}
      <style>
        .btn-ms {
          padding: 12px 15px;
          font-size: 18px;
          border-radius: 10px;
          /* width: 32%; */
          width: 200px;
        }

        .btn-tbl {
          padding: 0.0001px 5px;
          font-size: 14px;
          border-radius: 0.0001px;
        }
      </style>

      <style>
        * {
          box-sizing: border-box;
        }

        /* Create two equal columns that floats next to each other */
        .column1 {
          float: left;
          width: 50%;
          padding: 1px 0.1px 1px 11.9px;
        }

        .thumbnail {
          /* margin-bottom: 20px;  */
          padding-right: 17px;
          padding-left: 17px;
          margin-left: -100px;
          margin-right: -100px
        }
      </style>


      <div class="thumbnail">
        <div class="row">
          <div class="col-md-8">


            <button class="btn btn-success btn-ms" id="next_student" disabled="disabled">
              <span class="glyphicon glyphicon-user"></span> Next student
            </button>
            <!-- <a class="btn btn-primary btn-lg" id= "count_hands_up">
                <span class="glyphicon glyphicon-cog"></span> Count hands up
              </a> -->
            <button class="btn btn-success btn-ms" id="clear_all" disabled="disabled">
              <span class="glyphicon glyphicon-erase"></span> Clear
            </button>
            <button class="btn btn-success btn-ms" id="enable">Enable Green</button>
            <!-- <a class="btn btn-success btn-ms" id = "disable">
                <span class="glyphicon glyphicon-remove"></span> Disable 
              </a> -->



            </br>

            <button class="btn btn-primary btn-ms" id="next_student_blue" disabled="disabled">
              <span class="glyphicon glyphicon-user"></span> Next student
            </button>
            <!-- <a class="btn btn-primary btn-lg" id= "count_hands_up">
                <span class="glyphicon glyphicon-cog"></span> Count hands up
              </a> -->
            <button class="btn btn-primary btn-ms" id="clear_all_blue" disabled="disabled">
              <span class="glyphicon glyphicon-erase"></span> Clear
            </button>
            <button class="btn btn-primary btn-ms" id="enable_blue">Enable Blue</button>
            <!-- <a class="btn btn-primary btn-ms" id = "disable_blue">
                <span class="glyphicon glyphicon-remove"></span> Disable 
              </a> -->

            <!-- <a class="btn btn-primary btn-lg " id = "disable">
                <span class="glyphicon glyphicon-arrow-left"></span> 
              </a> -->

            </br>
            <button class="btn btn-danger btn-ms" id="next_student_red" disabled="disabled">
              <span class="glyphicon glyphicon-user"></span> Next student
            </button>
            <!-- <a class="btn btn-primary btn-lg" id= "count_hands_up">
                <span class="glyphicon glyphicon-cog"></span> Count hands up
              </a> -->
            <button class="btn btn-danger btn-ms" id="clear_all_red" disabled="disabled">
              <span class="glyphicon glyphicon-erase"></span> Clear
            </button>
            <button class="btn btn-danger btn-ms" id="enable_red">Enable Red</button>
            <!-- <a class="btn btn-danger btn-ms" id = "disable_red">
                <span class="glyphicon glyphicon-remove"></span> Disable 
              </a> -->

            </br>
            <button class="btn btn-warning btn-ms" id="next_student_yellow" disabled="disabled">
              <span class="glyphicon glyphicon-user"></span> Next student
            </button>
            <!-- <a class="btn btn-primary btn-lg" id= "count_hands_up">
              <span class="glyphicon glyphicon-cog"></span> Count hands up
            </a> -->
            <button class="btn btn-warning btn-ms" id="clear_all_yellow" disabled="disabled">
              <span class="glyphicon glyphicon-erase"></span> Clear
            </button>
            <button class="btn btn-warning btn-ms" id="enable_yellow">Enable Yellow</button>
            <!-- <a class="btn btn-warning btn-ms" id = "disable_yellow">
              <span class="glyphicon glyphicon-remove"></span> Disable 
            </a> -->

            <!-- <a class="btn btn-danger btn-lg " id = "disable">
                <span class="glyphicon glyphicon-arrow-left"></span> 
              </a> -->

            </br>

            <button class="btn btn-outline-dark btn-ms" id="enable_all">
              <span class="glyphicon glyphicon-ok"></span> Enable All
            </button>
            <!-- <a class="btn btn-primary btn-lg" id= "count_hands_up">
                <span class="glyphicon glyphicon-cog"></span> Count hands up
              </a> -->
            <button class="btn btn-dark btn-ms" id="clear_all_lists">
              <span class="glyphicon glyphicon-erase"></span> Clear All
            </button>
            <button class="btn btn-dark btn-ms" id="disable_all"> <span class="glyphicon glyphicon-remove"></span>
              Disable All</button>
            <!-- <a class="btn btn-success btn-ms" id = "disable">
                <span class="glyphicon glyphicon-remove"></span> Disable 
              </a> -->

          </div>
          <!-- <img id="headshot"  src="" style="display:none;width:220px;height:250px;"/>   </br> -->

          <div class="col-md-4">
            <h3 id="student"></h3>
          </div>
        </div>

        <div class="row" style="padding: 10px">
          <!-- <div class="column" > -->
          <!-- <h3 id="student"></h3>  -->
          <!-- <img id="headshot"  src="" style="display:none;width:220px;height:250px;"/>   </br> -->
          <!-- </div> -->
          <div class="col-md-4" style="border-right: 2px solid #333; height: 500px;">
            <h3>List of hand ups</h3>
            <h5 id="status"></h5>
            <div>
              <canvas id="myChart" width="100%" height="200px"></canvas>
            </div>
            <!-- <h3 id="unspoken"></h3> -->
            <!-- <h3 id="spoken"></h3> -->
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Student</th>
                  <th scope="col">Spoken</th>
                  <th scope="col">List</th>
                </tr>
              </thead>
              <tbody id='table'>
              </tbody>
            </table>
            <div class="row">
              <a class="btn btn-secondary btn-lg " id="undo">
                <span class="glyphicon glyphicon-arrow-left"></span> Undo Last Call
              </a>
            </div>
          </div>
          <div class="col-md-4" style="height: 500px;">
            <h3>List of already spoken</h3>
            <h5 id="status_spoken"></h5>
            <!-- <canvas id="myChart1" style="width:100%"></canvas> -->
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Student</th>
                  <th scope="col">List</th>
                  <th scope="col">Count</th>
                  <!-- <th scope="col">Spoken</th> -->
                </tr>
              </thead>
              <tbody id='table_of_spoken'>
              </tbody>
            </table>
          </div>

          <style>
            #message-board-header button{
              float: right;
              margin-right: 70px;
            }
          </style>

          <div class="col-md-4" style="border-left: 2px solid #333; height: 500px;">
            <div id="message-board-header">
              <h3>Message Board
                {% if lecture %}
                <button onclick="toggleMessageBoard(this)" class="btn btn-primary">
                  {% if lecture.enable_messages %}
                    Disable
                  {% else %}
                    Enable
                  {% endif %}
                </button>
                {% endif %}
              </h3>
            </div>
            <iframe id="message-instructor" src="/message/instructor" width="100%" height="400px" frameborder="0"></iframe>
          </div>
        </div>

        <script>
          function toggleMessageBoard(btn) {
            btnValue = btn.innerHTML.replace(/\s/g, '');

            // if btnValue is "Disable", then we want to disable the message board
            if (btnValue == "Disable") {
              btn.innerHTML = "Enable";

              $.ajax({
                url: '/message/instructor',
                beforeSend: function (xhr, settings) {
                  xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                },
                method: 'GET',
                data: { 'toggle-message-board': false  },
                success: function (data) {
                  console.log(data)
                }
              });
            } else if (btnValue == "Enable") {
              btn.innerHTML = "Disable";

              $.ajax({
                url: '/message/instructor',
                beforeSend: function (xhr, settings) {
                  xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                },
                method: 'GET',
                data: { 'toggle-message-board': true  },
                success: function (data) {
                  console.log(data)
                }
              });
            }
          }
        </script>

        <div>
          <iframe id="polling-instructor" scrolling="no" onload="resizeIframe(this)" src="/polling/instructor" width="100%" frameborder="0"></iframe>
        </div>

        <script>
          iFrameResize({ heightCalculationMethod: 'documentElementOffset' }, '#polling-instructor')
        </script>

      </div>

      <!-- <div class="col-md-12">
              <div class="col-md-6">
                <canvas id="myChart" style="width:100%"></canvas>
              </div>
              <div class="col-md-6">
                <canvas id="myChart1" style="width:100%"></canvas>
              </div>
            </div> -->


      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>



      <div>

        <style>
          #myDIV {
            width: 100%;
            padding: 5px 0;
            /* text-align: center; */
            background-color: lightblue;
            margin-top: 5px;
          }
        </style>

        <button class="btn btn-primary btn-lg" onclick="hideFunction()">README</button>

        <div id="myDIV" style="display:none">
          <p>
            There are 4 lists, Green, Blue, and Red.
            The Green list is the main one that is normally used.
            The Blue list is the list that students can use to bypass the main list.
            The Red list is the list that could be used for questions, etc.
            The Yellow list is for clicker questions.
            <!-- The Blue and Red list follow the same point system, however, by default no participation credit is assigned upon using the Red list.  -->
          </p>

          <p>
            This app has the following point system for the class by default, first-time hand up has 10 points, each
            subsequent one has 1 extra point, if a student speaks upon participation, they’d get 1 point each time
            someone from the same list they were chosen speaks.
            Participation in the Red list has no points. Notice that the mentioned given number of points to each
            category can be updated in course configuration. </br>

            There is also an undo button that reverts the last operation. It can revert everything, step by step, all
            the way to the beginning of the class. It does not delete anything, it just excludes them from the
            calculations (so we still log the things that happened) and puts the hands of the guy who was chosen to
            speak back up. </br>

            There is also a “choose next” button in front of each student in the list so that they can manually be
            chosen next.
          </p>
          <p>
            To get a test class to play with, use the following info. </br>

            Url to log in: https://mta.students.cs.ubc.ca/account/login/ </br>

            Instructor's username: “Kevin" </br>

            Student 1 username: “John" </br>

            Student 2 username: “Jane" </br>

            Password for all of the users: “agoraagora”
          </p>

        </div>

        <script>
          function hideFunction() {
            var x = document.getElementById("myDIV");
            if (x.style.display === "none") {
              x.style.display = "block";
            } else {
              x.style.display = "none";
            }
          }
        </script>
      </div>

      <script type="text/javascript">
        var btn = document.getElementById("next_student")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/random_student/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student").innerHTML = '<span style=\"color:' + 'Green' + '\">' + 'Green' + ': ' + data['student'] + '</span>';
              if (data['student_id'] != 'None') {
                $("<tr><td scope=\"row\">" + data['student'] + "</td><td scope=\"row\">" + 'Green' + "</td><td scope=\"row\">" + '-' + "</td></tr>").prependTo("#table_of_spoken");
                document.getElementById('headshot').src = "/static/images/headshots/" + data['student_id'] + ".png"
                document.getElementById('headshot').style.display = 'block';
              }
              else {
                document.getElementById('headshot').style.display = 'none';
              }

            }
          });
        });
        var btn = document.getElementById("next_student_blue")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/random_student_blue/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student").innerHTML = '<span style=\"color:' + 'Blue' + '\">' + 'Blue' + ': ' + data['student'] + '</span>';
              if (data['student_id'] != 'None') {
                $("<tr><td scope=\"row\">" + data['student'] + "</td><td scope=\"row\">" + 'Blue' + "</td><td scope=\"row\">" + '-' + "</td></tr>").prependTo("#table_of_spoken");
                // document.getElementById('headshot').src = "/static/images/headshots/"+data['student_id']+".png"
                document.getElementById('headshot').style.display = 'block';
              }
              else {
                document.getElementById('headshot').style.display = 'none';
              }

            }
          });
        });
        var btn = document.getElementById("next_student_red")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/random_student_red/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student").innerHTML = '<span style=\"color:' + 'Red' + '\">' + 'Red' + ': ' + data['student'] + '</span>';
              if (data['student_id'] != 'None') {
                $("<tr><td scope=\"row\">" + data['student'] + "</td><td scope=\"row\">" + 'Red' + "</td><td scope=\"row\">" + '-' + "</td></tr>").prependTo("#table_of_spoken");
                // document.getElementById('headshot').src = "/static/images/headshots/"+data['student_id']+".png"
                document.getElementById('headshot').style.display = 'block';
              }
              else {
                document.getElementById('headshot').style.display = 'none';
              }

            }
          });
        });
        var btn = document.getElementById("next_student_yellow")
        btn.addEventListener("click", function () {
          $.ajax({
            url: '/random_student_yellow/',
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student").innerHTML = '<span style=\"color:' + 'Orange' + '\">' + 'Yellow' + ': ' + data['student'] + '</span>';
              if (data['student_id'] != 'None') {
                $("<tr><td scope=\"row\">" + data['student'] + "</td><td scope=\"row\">" + 'Yellow' + "</td><td scope=\"row\">" + '-' + "</td></tr>").prependTo("#table_of_spoken");
                // document.getElementById('headshot').src = "/static/images/headshots/"+data['student_id']+".png"
                document.getElementById('headshot').style.display = 'block';
              }
              else {
                document.getElementById('headshot').style.display = 'none';
              }

            }
          });
        });
      </script>
      <script>
        // var btn= document.getElementById("choose_next")
        // console.log(btn)
        // btn.addEventListener("click", function() {  
        function myFunction(student_id, list_id) {
          $.ajax({
            url: "/choose_next/" + student_id + "/" + list_id,
            method: 'GET',
            success: function (data) {
              console.log(data)
              document.getElementById("student").innerHTML = '<span style=\"color:' + data['color'] + '\">' + data['color'] + ': ' + data['student'] + '</span>';
              if (data['student_id'] != 'None') {
                $("<tr><td scope=\"row\">" + data['student'] + "</td><td scope=\"row\">" + data['color'] + "</td><td scope=\"row\">" + '-' + "</td></tr>").prependTo("#table_of_spoken");
                // document.getElementById('headshot').src = "/static/images/headshots/"+data['student_id']+".png"
                document.getElementById('headshot').style.display = 'block';
              }
              else {
                document.getElementById('headshot').style.display = 'none';
              }

            }
          });
        }
            // });
      </script>
      <style type="text/css">
        /* table tr#ROW1  {background-color:rgb(124, 241, 183);}
              table tr#ROW2  {background-color:rgb(154, 201, 240);}
              table tr#ROW3  {background-color:rgb(241, 145, 145);} */
        table tr#ROW1 {
          background-color: rgb(115, 202, 115);
        }

        table tr#ROW2 {
          background-color: rgb(168, 210, 247);
        }

        table tr#ROW3 {
          background-color: rgb(250, 137, 137);
        }

        table tr#ROW4 {
          background-color: rgb(250, 224, 137);
        }
      </style>
      <script type="text/javascript">
        var statusIntervalId = window.setInterval(count_hands_up, 1000);
        // var btn= document.getElementById("count_hands_up")
        // btn.addEventListener("click", function() {  
        function count_hands_up() {
          $.ajax({
            url: '/count_hands_up/',
            method: 'GET',
            success: function (data) {
              // console.log(data)
              if (data['green_enabled']) {
                document.getElementById("next_student").disabled = false
                document.getElementById("clear_all").disabled = false
                var btn = document.getElementById("enable")
                btn.innerHTML = "Disable Green"
              }
              if (data['blue_enabled']) {
                document.getElementById("next_student_blue").disabled = false
                document.getElementById("clear_all_blue").disabled = false
                var btn = document.getElementById("enable_blue")
                btn.innerHTML = "Disable Blue"
              }
              if (data['red_enabled']) {
                document.getElementById("next_student_red").disabled = false
                document.getElementById("clear_all_red").disabled = false
                var btn = document.getElementById("enable_red")
                btn.innerHTML = "Disable Red"
              }
              if (data['yellow_enabled']) {
                document.getElementById("next_student_yellow").disabled = false
                document.getElementById("clear_all_yellow").disabled = false
                var btn = document.getElementById("enable_yellow")
                btn.innerHTML = "Disable Yellow"
              }

              document.getElementById("status").innerHTML = data['count'];
              document.getElementById("status_spoken").innerHTML = data['count_spoken'];
              rows = create_table(data)
              plot_chart(data)
              plot_chart_spoken(data)
              console.log(rows)
              $('#table').html(rows);
            }
          });
        };
        function create_table(input) {
          let rows = '';
          console.log(input['list_of_unspoken'])
          for (var i = 0; i < input['yellow_list_of_unspoken'].length; i++) {
            rows += "<tr id= \"ROW4\"><td scope=\"row\">" + input['yellow_list_of_unspoken'][i][0] + ' ' + input['yellow_list_of_unspoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['yellow_list_of_unspoken'][i][2] + ",1" + ")\">(Choose next) </button>" + "</td><td scope=\"row\">" + "No" + "</td><th scope=\"row\">" + "Yellow" + "</th></tr>"
          }
          for (var i = 0; i < input['red_list_of_unspoken'].length; i++) {
            rows += "<tr id= \"ROW3\"><td scope=\"row\">" + input['red_list_of_unspoken'][i][0] + ' ' + input['red_list_of_unspoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['red_list_of_unspoken'][i][2] + ",3" + ")\">(Choose next) </button>" + "</td><td scope=\"row\">" + "No" + "</td><th scope=\"row\">" + "Red" + "</th></tr>"
          }
          for (var i = 0; i < input['blue_list_of_unspoken'].length; i++) {
            rows += "<tr id= \"ROW2\"><td scope=\"row\">" + input['blue_list_of_unspoken'][i][0] + ' ' + input['blue_list_of_unspoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['blue_list_of_unspoken'][i][2] + ",2" + ")\">(Choose next) </button>" + "</td><td scope=\"row\">" + "No" + "</td><th scope=\"row\">" + "Blue" + "</th></tr>"
          }
          for (var i = 0; i < input['list_of_unspoken'].length; i++) {
            rows += "<tr id= \"ROW1\"><td scope=\"row\">" + input['list_of_unspoken'][i][0] + ' ' + input['list_of_unspoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['list_of_unspoken'][i][2] + ",1" + ")\">(Choose next) </button>" + "</td><td scope=\"row\">" + "No" + "</td><th scope=\"row\">" + "Green" + "</th></tr>"
          }


          for (var i = 0; i < input['yellow_list_of_spoken'].length; i++) {
            rows += "<tr id= \"ROW4\"><td scope=\"row\">" + input['yellow_list_of_spoken'][i][0] + ' ' + input['yellow_list_of_spoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['yellow_list_of_spoken'][i][2] + ",3" + ")\"> (Choose next) </button>" + "</td><td scope=\"row\">" + "Yes" + "</td><th scope=\"row\">" + "Yellow" + "</th></tr>"
          }
          for (var i = 0; i < input['red_list_of_spoken'].length; i++) {
            rows += "<tr id= \"ROW3\"><td scope=\"row\">" + input['red_list_of_spoken'][i][0] + ' ' + input['red_list_of_spoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['red_list_of_spoken'][i][2] + ",3" + ")\"> (Choose next) </button>" + "</td><td scope=\"row\">" + "Yes" + "</td><th scope=\"row\">" + "Red" + "</th></tr>"
          }
          for (var i = 0; i < input['blue_list_of_spoken'].length; i++) {
            rows += "<tr id= \"ROW2\"><td scope=\"row\">" + input['blue_list_of_spoken'][i][0] + ' ' + input['blue_list_of_spoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['blue_list_of_spoken'][i][2] + ",2" + ")\"> (Choose next) </button>" + "</td><td scope=\"row\">" + "Yes" + "</td><th scope=\"row\">" + "Blue" + "</th></tr>"
          }
          for (var i = 0; i < input['list_of_spoken'].length; i++) {
            rows += "<tr id= \"ROW1\"><td scope=\"row\">" + input['list_of_spoken'][i][0] + ' ' + input['list_of_spoken'][i][1] + ' ' + "<button class=\"btn btn-link btn-tbl\" id=\"choose_next\" onclick=\"myFunction(" + input['list_of_spoken'][i][2] + ",1" + ")\"> (Choose next) </button>" + "</td><td scope=\"row\">" + "Yes" + "</td><th scope=\"row\">" + "Green" + "</th></tr>" + "<span>"
          }
          return rows
          // <tr><th scope="row">3</th><td>Larry</td><td>the Bird</td></tr>
        }
        // function updateHandsUp() {
        //     document.getElementById('count_hands_up').click()
        // }
        // setInterval(updateHandsUp, 1000);

        function plot_chart(input) {
          var xValues = ["Green", "Blue", "Red", "Yellow"];
          var yValues = input['count_total'];
          var barColors = ["green", "blue", "red", "orange"];

          new Chart("myChart", {
            type: "bar",
            data: {
              labels: xValues,
              datasets: [{
                backgroundColor: barColors,
                data: yValues,
              }]
            },
            options: {
              animation: {
                duration: 0
              },
              responsive: true,
              maintainAspectRatio: false,
              legend: { display: false },
              title: {
                display: false,
                text: "Hand ups bar plot"
              },
              scales: {
                yAxes: [{
                  ticks: {
                    beginAtZero: true
                  }
                }],
                xAxes: [{
                  // Change here
                  barPercentage: 0.5
                }]
              }
            }
          });
        }

        function plot_chart_spoken(input) {
          var xValues = ["Green", "Blue", "Red", "Yellow"];
          var yValues = input['count_total_spoken'];
          var barColors = ["green", "blue", "red", "orange"];

          new Chart("myChart1", {
            type: "bar",
            data: {
              labels: xValues,
              datasets: [{
                backgroundColor: barColors,
                data: yValues,
              }]
            },
            options: {
              animation: {
                duration: 0
              },
              legend: { display: false },
              title: {
                display: false,
                text: "Spoken bar plot"
              },
              scales: {
                yAxes: [{
                  ticks: {
                    beginAtZero: true
                  }
                }],
                xAxes: [{
                  // Change here
                  barPercentage: 0.5
                }]
              }
            }
          });
        }
      </script>


      <script type="text/javascript">
        // var statusIntervalId = window.setInterval(count_already_spoken, 1000);
        $(document).ready(function () {
          count_already_spoken();
        });
        // var btn= document.getElementById("count_hands_up")
        // btn.addEventListener("click", function() {  
        function count_already_spoken() {
          $.ajax({
            url: '/count_already_spoken/',
            method: 'GET',
            success: function (data) {
              // console.log(data)                  
              // document.getElementById("status_spoken").innerHTML = data['count_spoken'];
              spoken_rows = create_spoken_table(data)
              $('#table_of_spoken').html(spoken_rows);
            }
          });
        };


        function create_spoken_table(input) {
          let rows = '';
          console.log(input['list_of_already_spoken'])
          let max_len = Math.min(input['list_of_already_spoken'].length, 100)
          for (var i = 0; i < max_len; i++) {
            // rows += "<tr><td scope=\"row\">"+input['list_of_already_spoken'][i][0]+"</td><td scope=\"row\">"+input['list_of_already_spoken'][i][1]+"</td><th scope=\"row\">"+ "Yes" +"</th></tr>"
            rows += "<tr><td scope=\"row\">" + input['list_of_already_spoken'][i][0] + ' ' + input['list_of_already_spoken'][i][1] + "</td><td scope=\"row\">" + input['list_of_already_spoken'][i][2] + "</td><td scope=\"row\">" + input['list_of_already_spoken'][i][3] + "</td></tr>"

          }
          return rows
          // <tr><th scope="row">3</th><td>Larry</td><td>the Bird</td></tr>
        }
          // function updateHandsUp() {
          //     document.getElementById('count_hands_up').click()
          // }
          // setInterval(updateHandsUp, 1000);
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("clear_all")
        btn.addEventListener("click", function () {
          // if(!confirm('You are about to clear the Green list. Are you sure?')) {
          //           e.preventDefault();
          //       }
          document.getElementById("student").innerHTML = 'All hands were cleared in the Green list.'
          $.ajax({
            url: '/clear_all/',
            method: 'GET',
          });
        });
        var btn = document.getElementById("clear_all_blue")
        btn.addEventListener("click", function () {
          // if(!confirm('You are about to clear the Blue list. Are you sure?')) {
          //           e.preventDefault();
          //       }
          document.getElementById("student").innerHTML = 'All hands were cleared in the Blue list.'
          $.ajax({
            url: '/clear_all_blue/',
            method: 'GET',
          });
        });
        var btn = document.getElementById("clear_all_red")
        btn.addEventListener("click", function () {
          // if(!confirm('You are about to clear the Red list. Are you sure?')) {
          //           e.preventDefault();
          //       }
          document.getElementById("student").innerHTML = 'All hands were cleared in the Red list.'
          $.ajax({
            url: '/clear_all_red/',
            method: 'GET',
          });
        });

        var btn = document.getElementById("clear_all_yellow")
        btn.addEventListener("click", function () {
          // if(!confirm('You are about to clear the Yellow list. Are you sure?')) {
          //           e.preventDefault();
          //       }
          document.getElementById("student").innerHTML = 'All hands were cleared in the Yellow list.'
          $.ajax({
            url: '/clear_all_yellow/',
            method: 'GET',
          });
        });

        var btn = document.getElementById("clear_all_lists")
        btn.addEventListener("click", function () {
          if (!confirm('You are about to clear all lists. Are you sure?')) {
            e.preventDefault();
          }
          document.getElementById("student").innerHTML = 'All hands were cleared.'
          $.ajax({
            url: '/clear_all_lists/',
            method: 'GET',
          });
        });

        var btn = document.getElementById("undo")
        btn.addEventListener("click", function () {
          document.getElementById("student").innerHTML = 'All participation record were removed from the last call.'
          $.ajax({
            url: '/undo/',
            method: 'GET',
            success: function (data) {
              // console.log(data)                  
              document.getElementById("status_spoken").innerHTML = data['count_spoken'];
              spoken_rows = create_spoken_table(data)
              $('#table_of_spoken').html(spoken_rows);
            }
          });
        });

      </script>


      <script type="text/javascript">
        var btn = document.getElementById("enable")
        btn.addEventListener("click", function () {
          var btn = document.getElementById("enable")
          if (btn.innerHTML === "Enable Green") {
            document.getElementById("next_student").disabled = false
            document.getElementById("clear_all").disabled = false
            document.getElementById("student").innerHTML = 'Hand up feature is enabled for the Green list.'
            $.ajax({
              url: '/enable/',
              method: 'GET',
            });
            btn.innerHTML = "Disable Green";
          }
          else {
            document.getElementById("next_student").disabled = true
            document.getElementById("clear_all").disabled = true
            document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Green list.'
            $.ajax({
              url: '/disable/',
              method: 'GET',
            });
            btn.innerHTML = "Enable Green";
          }

        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("enable_blue")
        btn.addEventListener("click", function () {
          var btn = document.getElementById("enable_blue")
          if (btn.innerHTML === "Enable Blue") {
            document.getElementById("next_student_blue").disabled = false
            document.getElementById("clear_all_blue").disabled = false
            document.getElementById("student").innerHTML = 'Hand up feature is enabled for the Blue list.'
            $.ajax({
              url: '/enable_blue/',
              method: 'GET',
            });
            btn.innerHTML = "Disable Blue";
          }
          else {
            document.getElementById("next_student_blue").disabled = true
            document.getElementById("clear_all_blue").disabled = true
            document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Blue list.'
            $.ajax({
              url: '/disable_blue/',
              method: 'GET',
            });
            btn.innerHTML = "Enable Blue";
          }

        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("enable_red")
        btn.addEventListener("click", function () {
          var btn = document.getElementById("enable_red")
          if (btn.innerHTML === "Enable Red") {
            document.getElementById("next_student_red").disabled = false
            document.getElementById("clear_all_red").disabled = false
            document.getElementById("student").innerHTML = 'Hand up feature is enabled for the Red list.'
            $.ajax({
              url: '/enable_red/',
              method: 'GET',
            });
            btn.innerHTML = "Disable Red";
          }
          else {
            document.getElementById("next_student_red").disabled = true
            document.getElementById("clear_all_red").disabled = true
            document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Red list.'
            $.ajax({
              url: '/disable_red/',
              method: 'GET',
            });
            btn.innerHTML = "Enable Red";
          }

        });
      </script>


      <script type="text/javascript">
        var btn = document.getElementById("enable_yellow")
        btn.addEventListener("click", function () {
          var btn = document.getElementById("enable_yellow")
          if (btn.innerHTML === "Enable Yellow") {
            document.getElementById("next_student_yellow").disabled = false
            document.getElementById("clear_all_yellow").disabled = false
            document.getElementById("student").innerHTML = 'Hand up feature is enabled for the Yellow list.'
            $.ajax({
              url: '/enable_yellow/',
              method: 'GET',
            });
            btn.innerHTML = "Disable Yellow";
          }
          else {
            document.getElementById("next_student_yellow").disabled = true
            document.getElementById("clear_all_yellow").disabled = true
            document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Yellow list.'
            $.ajax({
              url: '/disable_yellow/',
              method: 'GET',
            });
            btn.innerHTML = "Enable Yellow";
          }

        });

      </script>

      <script type="text/javascript">
        var btn = document.getElementById("disable_all")
        btn.addEventListener("click", function () {
          document.getElementById("next_student").disabled = true
          document.getElementById("next_student_blue").disabled = true
          document.getElementById("next_student_red").disabled = true
          document.getElementById("next_student_yellow").disabled = true

          document.getElementById("clear_all").disabled = true
          document.getElementById("clear_all_blue").disabled = true
          document.getElementById("clear_all_red").disabled = true
          document.getElementById("clear_all_yellow").disabled = true

          var btn = document.getElementById("enable")
          btn.innerHTML = "Enable Green";
          var btn = document.getElementById("enable_blue")
          btn.innerHTML = "Enable Blue";
          var btn = document.getElementById("enable_red")
          btn.innerHTML = "Enable Red";
          var btn = document.getElementById("enable_yellow")
          btn.innerHTML = "Enable Yellow";

          document.getElementById("student").innerHTML = 'Hand up feature is disabled in all lists.'

          $.ajax({
            url: '/disable_all/',
            method: 'GET',
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("enable_all")
        btn.addEventListener("click", function () {
          document.getElementById("next_student").disabled = false
          document.getElementById("next_student_blue").disabled = false
          document.getElementById("next_student_red").disabled = false
          document.getElementById("next_student_yellow").disabled = false

          document.getElementById("clear_all").disabled = false
          document.getElementById("clear_all_blue").disabled = false
          document.getElementById("clear_all_red").disabled = false
          document.getElementById("clear_all_yellow").disabled = false

          var btn = document.getElementById("enable")
          btn.innerHTML = "Disable Green";
          var btn = document.getElementById("enable_blue")
          btn.innerHTML = "Disable Blue";
          var btn = document.getElementById("enable_red")
          btn.innerHTML = "Disable Red";
          var btn = document.getElementById("enable_yellow")
          btn.innerHTML = "Disable Yellow";

          document.getElementById("student").innerHTML = 'Hand up feature is enabled in all lists.'

          $.ajax({
            url: '/enable_all/',
            method: 'GET',
          });
        });
      </script>


      <!-- <script type="text/javascript">
              var btn= document.getElementById("disable")
              btn.addEventListener("click", function() {
              document.getElementById("next_student").disabled = true 
              document.getElementById("clear_all").disabled = true 
              document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Green list.'
              $.ajax({
                      url: '/disable/',
                      method : 'GET',
                  }); 
              });
           </script> -->


      <!-- <script type="text/javascript">
              var btn= document.getElementById("enable_blue")
              btn.addEventListener("click", function() {
              document.getElementById("next_student_blue").disabled = false 
              document.getElementById("clear_all_blue").disabled = false 
              document.getElementById("student").innerHTML = 'Hand up feature is enabled for the Blue list.'
              $.ajax({
                      url: '/enable_blue/',
                      method : 'GET',
                  }); 
              });
            </script> -->

      <!-- <script type="text/javascript">
              var btn= document.getElementById("disable_blue")
              btn.addEventListener("click", function() {  
              document.getElementById("next_student_blue").disabled = true
              document.getElementById("clear_all_blue").disabled = true
              document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Blue list.'
              $.ajax({
                      url: '/disable_blue/',
                      method : 'GET',
                  }); 
              });
            </script>
  
  
            <script type="text/javascript">
              var btn= document.getElementById("enable_red")
              btn.addEventListener("click", function() { 
              document.getElementById("next_student_red").disabled = false   
              document.getElementById("student").innerHTML = 'Hand up feature is enabled for the Red list.'
              $.ajax({
                      url: '/enable_red/',
                      method : 'GET',
                  }); 
              });
           </script>
    
            <script type="text/javascript">
              var btn= document.getElementById("disable_red")
              btn.addEventListener("click", function() {  
              document.getElementById("next_student_red").disabled = true  
              document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Red list.'
              $.ajax({
                      url: '/disable_red/',
                      method : 'GET',
                  }); 
              });
           </script>
  
            <script type="text/javascript">
              var btn= document.getElementById("enable_yellow")
              btn.addEventListener("click", function() { 
              document.getElementById("next_student_yellow").disabled = false 
              document.getElementById("student").innerHTML = 'Hand up feature is enabled for the Yellow list.'
              $.ajax({
                      url: '/enable_yellow/',
                      method : 'GET',
                  }); 
              });
            </script>
  
            <script type="text/javascript">
              var btn= document.getElementById("disable_yellow")
              btn.addEventListener("click", function() {
              document.getElementById("next_student_yellow").disabled = true 
              document.getElementById("student").innerHTML = 'Hand up feature is disabled for the Yellow list.'
              $.ajax({
                      url: '/disable_yellow/',
                      method : 'GET',
                  }); 
              }); -->
      </script>


      {%endif%}


      {% if is_instructor or request.user.is_superuser %}
      
      <div class="row">
        <div class="col-sm-6 col-md-offset-0 col-md-8">
          <div class="mta-header-with-btn">
            <h2>Control Panel</h2>
          </div>
        </div>
      </div>
      <div class="thumbnail">
        <button class="btn btn-danger " id="disqualify_all">
          <span class="glyphicon glyphicon-erase"></span> Disqualify Everyone
        </button>
        <button class="btn btn-warning " id="reset_class_participation">
          <span class="glyphicon glyphicon-erase"></span> Reset per-class participation
        </button>
        <button class="btn btn-warning " id="reset_participation_points">
          <span class="glyphicon glyphicon-erase"></span> Reset per-week participation
        </button>
        <a class="btn btn-primary " href="/grade/upload_grading_items">
          <span class="glyphicon glyphicon-pencil"></span> Upload Grading Items
        </a>
      </div>
      
      <script type="text/javascript">
        var btn = document.getElementById("disqualify_all")
        btn.addEventListener("click", function () {
          if (!confirm('You are about to disqualify every student to do peer reviews. Are you sure?')) {
            e.preventDefault();
          }
          $.ajax({
            url: '/disqualify_all/',
            method: 'GET',
            success: function () {
              alert("Every student was disqualified to do peer reviews. They can qualify themselves again by finishing their weekly quiz.");
            }
          });
        });
      </script>


      <script type="text/javascript">
        var btn = document.getElementById("reset_class_participation")
        btn.addEventListener("click", function () {
          if (!confirm('You are about to reset every in-class participation recorded in MTA for this class. Are you sure?')) {
            e.preventDefault();
          }
          $.ajax({
            url: '/reset_class_participation/',
            method: 'GET',
            success: function () {
              alert("Every student in-class participation was cleared");
            }
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("reset_participation_points")
        btn.addEventListener("click", function () {
          if (!confirm('You are about to clear every students particpation point for this week. Are you sure?')) {
            e.preventDefault();
          }
          $.ajax({
            url: '/reset_participation_points/',
            method: 'GET',
            success: function () {
              alert("Every student weekly participation points was cleared");
            }
          });
        });
      </script>
      {%endif%}

      {% if is_instructor or request.user.is_superuser %}
      <div class="thumbnail">
        <div class="caption">
          <!-- <h3>Students</h3> -->
          <div class="row">
            <div class="col-md6 col-sm-12">
              <dl class="dl-horizontal" style="margin-bottom:0">
                <dt> # Students:</dt>
                <dd><code>{{num_students}}</code></dd>
                {% if course.enable_independent_pool %}
                <dt> # Supervised:</dt>
                <dd><code>{{num_supervised}}</code></dd>
                <dt> # Independent:</dt>
                <dd><code>{{num_independent}}</code></dd>
                {% endif %}
              </dl>
            </div>
          </div>
        </div>
      </div>
      {%endif%}



      {% if is_ta %}
      <div class="thumbnail">
        <div class="caption">
          <div class="row">
            <div class="col-md-8">
              <iframe id="polling-student" scrolling="no" onload="resizeIframe(this)"  src="/polling/student" width="100%" frameborder="0"></iframe>
            </div>
            
            <div class="col-md-4">
              <h3>Message Board</h3>
              <iframe id="message-instructor" src="/message/instructor" width="100%" height="400px" frameborder="0"></iframe>
            </div>
          </div>
        </div>
      </div>

      <div class="thumbnail">
        <div class="caption">
          <!-- <h3>Students</h3> -->
          <div class="row">
            <div class="col-md12 col-sm-10">
              <dl class="dl-horizontal" style="margin-bottom:0">
                <dt> Total #TA reviews:</dt>
                <dd><code>{{total_reviews}}</code></dd>
                <dt> My total #reviews: </dt>
                <dd><code>{{user_total_reviews}}</code></dd>
                <dt> #Time Spent [hh:mm:ss]:</dt>
                <dd><code>{{timer}}</code></dd>
              </dl>
            </div>
          </div>
        </div>
        <button class="btn btn-success btn-ms" id="start_timer">
          <span class="glyphicon glyphicon-user"></span> Start Timer
        </button>
        <button class="btn btn-danger btn-ms" id="stop_timer">
          <span class="glyphicon glyphicon-user"></span> Stop Timer
        </button>
      </div>

      <script type="text/javascript">
        var btn = document.getElementById("start_timer")
        btn.addEventListener("click", function () {
          if (!confirm('You are about to start you timer. Are you sure?')) {
            e.preventDefault();
          }
          $.ajax({
            url: '/start_timer/',
            method: 'GET',
            success: function (data) {
              alert(data['response']);
            }
          });
        });
      </script>

      <script type="text/javascript">
        var btn = document.getElementById("stop_timer")
        btn.addEventListener("click", function () {
          if (!confirm('You are about to stop your timer. Are you sure?')) {
            e.preventDefault();
          }
          $.ajax({
            url: '/stop_timer/',
            method: 'GET',
            success: function (data) {
              alert(data['response']);
            }
          });
        });
      </script>


      {%endif%}

      <div>
        {% if is_ta %}
        <a class="btn btn-primary" href="/review/{{ course.id }}/request_next/"> <span
            class="glyphicon glyphicon-pencil"></span> Request the next submission to review</a>
        {% endif %}
        </br>
      </div>

      <!-- <h2 class="page-header">Dashboard</h2> -->

      <!-- <div class="thumbnail">
        <div class="caption">
          <h3>General course information</h3>
          
          <div class="row">
            <div class="col-md-6 col-sm-12">
          
              <dl class="dl-horizontal">
                <dt>Display Name</dt>
                <dd>{{ course.displayname }}</dd>

                
                {% if not request.user.is_superuser %}
                <dt>My role</dt>
                <dd>{{ coursemember.role | title }}</dd>
                {% endif %}
               

                <dt>Student code</dt>
                <dd><code>{{ course.stucode }}</code></dd>
                
                {% if is_instructor or is_ta or request.user.is_superuser %}
   
                <dt>Instructor code</dt>
                <dd><code>{{ course.instructor_code }}</code></dd>
            
                <dt>TA code</dt>
                <dd><code>{{ course.tascode }}</code></dd>

                <dt>Visible to students</dt>
                <dd>{{ course.browsable }}</dd>
            
                <dt>Archived</dt>
                <dd>{{ course.archived }}</dd>
            
                {% endif %}
            
              </dl>
            </div>
          
            <div class="col-md-6 col-sm-12">   
          
              {% if is_instructor or is_ta or request.user.is_superuser %}
 
              <div class="btn-group-vertical btn-group-veritcal-justified" role="group" aria-label="...">
                {% if not is_ta %}
                  <a class="btn btn-primary" href="/course/{{ course.id }}/edit/">
                    <span class="glyphicon glyphicon-pencil"></span> Edit Configurations
                  </a>
                {% endif %}
                <a class="btn btn-info" href="/course/{{ course.id }}/list_users/">
                  <span class="glyphicon glyphicon-user"></span> Display Users
                </a>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div> -->

    </div>

    <div class="col-xs-8 col-sm-8 col-md-8 col-xs-offset-2 col-md-offset-2 col-sm-offset-2">
      <div class="thumbnail">
        <div class="caption">
          <h3>Tasks to be completed</h3>

          {% if todos|length == 0 %}
          <div class="well">No todo items.</div>
          {% else %}
          <table class="table">
            <thead>
              <tr>
                <th>Task</th>
                <th>Deadline</th>
                <th>Link</th>
                <th>Extra</th>
              </tr>
            </thead>
            <tbody>
              {% load typeof %}
              {% for todo in todos %}
              <tr class="{% if todo.deadline_passed %}bg-danger{% endif %}">
                {% if todo|typeof == "Assignment" %}
                <td><a href="{% url 'assignment:view' todo.id %}">{{ todo.name }}</a></td>
                <td> {{ todo.deadline }} {% if todo.deadline_passed %}(passed) {%else%} (Remaning time:
                  {{todo.time_until_deadline_passed }}){% endif %} </td>
                <td>
                  {% submission_create_button todo '' 'Create my submission' %}
                </td>
                <td>---</td>
                {% elif todo|typeof == "ReviewAssignment" and todo.submission.calibration_id == 0%}
                <td><a href="{% url 'assignment:submission_view' todo.submission.id %}">
                    Review for {{ todo.submission.assignment.name }}{% if todo.question %}<small> ({{
                      todo.question.title }})</small>{% endif %}
                  </a></td>
                <td>{{ todo.deadline }}{% if todo.deadline_passed %} <strong>(passed)</strong>{%else%} (Remaning time:
                  {{todo.time_until_deadline_passed }}){% endif %}</td>
                <td><a href="/review/{{ todo.id }}/create/" target="">Start my review</a></td>
                <td><a href="/calibration/{{ todo.submission.assignment.id }}/request/" target="">Request
                    calibration</a></td>
                {% elif todo|typeof == "ReviewAssignment" and todo.submission.calibration_id != 0 %}
                <td><a href="{% url 'assignment:submission_view' todo.submission.id %}">Calibration review for {{
                    todo.submission.assignment.name }}</a></td>
                <td>---</td>
                <td><a href="/calibration/{{ todo.id }}/create/" target="">Start my calibration review</a></td>
                <td>---</td>
                {% elif todo|typeof == "EvaluationAssignment" %}
                <td><a href="{% url 'review:view' todo.review.id %}">Review evaluation for {{
                    todo.review.submission.assignment.name }}</a></td>
                <td>{{ todo.deadline }}{% if todo.deadline_passed %} <strong>(passed)</strong>{% endif %}</td>
                <td><a href="/evaluation/{{ todo.id }}/create/" target="">Start my evaluation</a></td>
                <td>---</td>
                {% elif todo|typeof == "InaptReport" %}
                <td>Report for {{ todo.review.submission.assignment.name }}</td>
                <td>---</td>
                <td><a href="{% url 'grade:report_view' todo.id %}" target="">Respond to report</a></td>
                {% else %}
                <td>Appeal for {{ todo.submission.assignment.name }}</td>
                <td>---</td>
                <td><a href="{% url 'grade:appeal_view' todo.id %}" target="">Respond to appeal</a></td>
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
          </table>

          {% endif %}
          <!-- <p><a href="/assignment/list_for_course/" class="btn btn-primary" role="button">
               <span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span> Go to Assignments
             </a></p>  
          <p><a href="/review/my_reviews_of_other_submissions/" class="btn btn-primary" role="button">
            <span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span> Go to Reviews</a></p> -->
        </div>


        {% if not is_instructor %}
        {% if course.id == 1 or course.id == 18 %}
        <div>
          <a href="/calibration/236/request/" target="">Request calibration for Essay 1</a> </br>
          <a href="/calibration/240/request/" target="">Request calibration for Essay 2</a> </br>
          <a href="/calibration/242/request/" target="">Request calibration for Essay 3</a> </br>
          <a href="/calibration/244/request/" target="">Request calibration for Essay 4</a> </br>
          <a href="/calibration/246/request/" target="">Request calibration for Essay 5</a> </br>
          <a href="/calibration/249/request/" target="">Request calibration for Essay 6</a> </br>
          <a href="/calibration/250/request/" target="">Request calibration for Essay 7</a> </br>

        </div>
      </div>


      <div>
        {%if is_student %}
        <a class="btn btn-primary " href="/grade/gradebook">
          <span class="glyphicon glyphicon-pencil"></span> View My Grades
        </a>
        {%endif%}
      </div>
      {% endif %}

      {% endif %}
    </div>
  </div>

  {%if is_instructor or is_ta %}
  <!-- TAs overview -->

  <div class="col-xs-8 col-sm-8 col-md-8 col-xs-offset-2 col-md-offset-2 col-sm-offset-2">
    <div class="thumbnail">
      <div class="caption">
        <h3>Teaching Assistants</h3>

        {% if not course.has_ta %}
        <div class="well">No TAs assigned to this course yet.</div>
        {% else %}
        <table class="table">
          <thead>
            <tr>
              <th class="col-md-6">Name</th>
              <th class="text-right">
                # Reviews (pending)
              </th>
              <th class="text-right">
                # Appeals (pending)
              </th>
            </tr>
          </thead>
          <tbody>
            {% for ta in ta_stats %}
            <tr class="">
              <td>{{ ta.name }}</td>
              <td
                class="text-right {% if ta.reviews.late %}bg-danger{% elif ta.reviews.pending %}bg-warning{% endif %}">
                {% if ta.reviews.late %}<small class="text-muted">(late)&nbsp;&nbsp; </small>{% endif %}
                {{ta.reviews.total}} ({{ta.reviews.pending}})
              </td>
              <td class="text-right">
                {{ta.appeal.total}} ({{ta.appeal.pending}})
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Assignments overview -->
  <div class="col-xs-8 col-sm-8 col-md-8 col-xs-offset-2 col-md-offset-2 col-sm-offset-2">
    <div class="thumbnail">
      <div class="caption">
        <h3>Assignments</h3>

        {% if not course.has_ta %}
        <div class="well">No TAs assigned to this course yet.</div>
        <!-- TODO -->
        {% else %}
        <table class="table">
          <thead>
            <tr>
              <th class="col-md-6">Name</th>
              <th class="text-right">
                Submissions
              </th>
              <th class="text-right">
                TA Reviews
              </th>
              <th class="text-right">
                Instructor Reviews
              </th>
              <th class="text-right">
                Student Reviews
              </th>
            </tr>
          </thead>
          <tbody>
            {% for assignment in course.assignment_set.all %}
            <tr class="">
              <td>
                <a href="{% url 'review:assignment_review_list' assignment.id %}">
                  <strong>{{ assignment.name }}</strong>
                </a>
              </td>
              <td class="text-right">
                {{ assignment.assignmentsubmission_set.all.count }} <small>/ {{ student_count }}</small>
              </td>
              <td class="text-right">
                {{ assignment.ta_reviews_count }}
              </td>
              <td class="text-right">
                {{ assignment.instructor_reviews_count }}
              </td>
              <td class="text-right">
                {{ assignment.student_reviews_count }}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}



  {% endblock %}
</div>